<%= content_for :html_head do %>
  <%= stylesheet_link_tag 'cms/sitemap' %>
  <%= javascript_include_tag 'cms/sitemap' %>  
<% end %>

<% page_title "Sitemap" %>

<%= content_for :functions do %>
  <h1>Sitemap</h1>
  <div class="btn-toolbar">
    <%= icon_link_to "Edit Page", '#', 'edit', :id => 'edit-button', :class => "btn disabled" %>
    <%= icon_link_to("Edit Properties", "#", 'edit', :id => 'properties-button', :class => "btn disabled") %>

    <%= white_icon_link_to "Add Page", '#', 'plus', :id => 'add-page-button', :class => "btn btn-success disabled" %>
    <%= white_icon_link_to "Add Section", '#', 'plus', :id => 'add-section-button', :class => "btn btn-success disabled" %>
    <%= white_icon_link_to "Add Link", '#', 'plus', :id => 'add-link-button', :class => "btn btn-success disabled" %>
    <%= delete_button %>
  </div>
<% end %>

<div id="sitemap">
  <ul id="root_<%= @section.id %>" class="root" style="padding-left: 0">
    <li>
      <%= render :partial => "node", :locals => {
              :node => @section,
              :node_type => "section",
              :icon => action_icon(:home),
              :display => true
      } %>
    </li>
  </ul>
  <%
     access_status = access_status(@section, @public_sections)
     @sitemap[@root_section_node].keys.each do |child_section_node| %>
      <%= render :partial => child_section_node.node.partial_for,
                 :locals => {:access_icon => access_status,
                             :node => child_section_node.node,
                             :parent => @section,
                             :child_hash => @sitemap[@root_section_node],
                             :key => child_section_node
                 }
      %>
  <% end %>
</div>

