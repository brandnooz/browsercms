<% @page_title = @toolbar_title = "List Versions / '#{@page.name}' Page" %>
<%= content_for(:html_head) do %>
  <%= javascript_tag do %>
    jQuery(function($){
      $('table.data tbody tr').hover(function(){
        $(this).addClass('hover')
      }, function(){
        $(this).removeClass('hover')
      }).click(function(){
        var match = this.id.match(/(.*)_(\d+)/) 
        var type = match[1];
        var id = match[2];
        $('table.data tbody tr').removeClass('selected');
        $(this).addClass('selected');
        $('#view_button').removeClass('disabled').attr('href', '/cms/pages/<%= @page.id %>/version/'+id+'?mode=view');
        if ($(this).hasClass('current')){
          $('#revert_button').addClass('disabled').attr('href', '');
          $('#revert_form').attr('action', '');
          $('#revert_form_version').attr('value', '');
          $('#edit_content_button').removeClass('disabled').attr('href', '/cms/pages/<%= @page.id %>?mode=edit');
          $('#edit_properties_button').removeClass('disabled').attr('href', '/cms/pages/<%= @page.id %>/edit');
        } else {
          $('#revert_button').removeClass('disabled');
          $('#revert_form').attr('action', '/cms/pages/<%= @page.id %>/revert_to/'+id);
          $('#revert_form_version').attr('value', id);
          $('#edit_content_button').addClass('disabled').attr('href', '');
          $('#edit_properties_button').addClass('disabled').attr('href', '');
        }
      })
    })
  <% end %>
  
  <%= stylesheet_link_tag("cms/form_layout") %>
<% end %>
<%= content_for :functions do %>
  <h1><%= @toolbar_title %></h1>
  <div class="btn-toolbar">
    <%= link_to "view", "#", :id => "view_button", :class => "btn disabled" %>
    <%= icon_link_to "edit content", "#", 'edit', :id => "edit_content_button", :class => "btn disabled" %>
    <%= icon_link_to "edit properties", "#", 'edit', :id => "edit_properties_button", :class => "btn disabled" %>
    <%= icon_link_to "revert", "#", 'refresh', :id => "revert_button", :class => "btn disabled", :onclick => "$('#revert_form').submit(); return false;" %>
    <%= form_tag '', :method => 'put', :id => "revert_form" do %>
      <%= hidden_field_tag :version, '', :id => 'revert_form_version'  %>
    <% end %>
  </div>
<% end %>

<table id="blocks" class="data table table-condensed">
  <thead>
    <tr>
      <th>Version</th>
      <th>Comment</th>
      <th>Date</th>
      <th>Editor</th>
    </tr>
  </thead>
  <tbody>
    <% @page.versions.all(:order => "version desc").each_with_index do |r, i| %>
      <% current = @page.version == r.version %>
      <tr id="revision_<%= r.version %>" <%= 'class="current"' if current %>>
        <td>
          <%= "v.#{r.version}" %>
          <%= '(LIVE)' if @page.version == r.version %>
          <%= '(CURRENT)' if i == 0 %>
        </td>
        <td><%= r.version_comment %></td>
        <td><%= r.created_at.strftime("%b %d, %Y %I:%M %p") if r.created_at %></td>
        <td><%= r.updated_by.login if r.updated_by %></td>
      </tr>
    <% end %>
  </tbody>
</table>

